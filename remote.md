# 2020年11月9日
## M5stackでリモコン機能を使う
## 目的
スライダーの機能を使ってリモート電子メトロノームを実現

## 目標
リモコンの機能をすべて利用したプログラムを作成

## プログラムの内容
スライダーの数値を利用して、ボタンを押すとその数値のBPMを音として再生する。

## 機能
1. リモートスライダーを使ってBPMの数値を変える(0～100)まで
1. リモートボタンを押すとBPMのテンポで音が鳴る
1. リモートラベルBPMの数値をスマホに interval:200 ごとに読み込み出力
1. リモートスイッチ初期値画面と現在のBPMとms確認画面を切り替え
1. 初期値・その他・今後の課題

## 各機能の説明
### 1. リモートスライダー
リモートスライダーの機能は 0 - 100 の数値をインデックスxとして数値を受け取り、グローバルであるbpmにxの数値を代入する。

### 2. リモートボタン

音声のデュレーション（長さ）はmsの単位なので「 (ms) ＝ 60 ÷ BPM × **1** × 1000 」の計算式で求めることができる。しかし、この「ms」は音と、音と音の間（無音）の合わせた長さなので、先ほどの数式の答えを 「(ms) ÷ 2」 する。よって、音と、音と音の間（無音）の別々のデュレーション（長さ）を取得することができる。

音が再生されない（無音）の部分は関数でまとめる。理由はプログラムの可読性をよくするため。この時関数を参照するプログラム実行時間は気にしないものとして考える。

音が再生される部分は関数としてはまとめない。音の高さを変えることによって小節先頭または途中などを表すためそれぞれを編集できるようにする。

一度鳴り出すとループを抜けることができないので、ループは３回に制限している。

### 3. リモートラベル

bpmの数値をスマホで可視化できるようにしている。

### 4. リモートスイッチ

初期値のページと現在のbpmとmsをスイッチで切り替えることができる。


### 5. その他・今後の課題

- 初期値のbpmは120bpmを設定している。

- リモートボタンの太字の１の部分は音符の種類を表している。　[リモートボタン参考サイト](https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q14106980424)

- QRコード機能はM5stackに小さく表示されるだけなので使用していない。(80の大きさで縦はぎりぎり表示できる。)

- 101以上のbpmにできない。

- 変数名やボタンなどのタイトルが適当すぎるので改善が必要。

- リモートスイッチを急いで作ったので、デバックすらしていないためバグだらけと思われる。

- 一度bpmが流れ出すと何をしても音が止まらないので、改善が必要。

- 今後の目標としてリモートでbpmを再生・停止をさせる。

